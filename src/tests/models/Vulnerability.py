from src.models.Vulnerability import Vulnerability
from src.models.Project import Project
from src.common.Database import Database

Database.initialize()
vulnerability01 = Vulnerability(
        report_id = "9d6d3736128649098d4e0f16c4278d07",
        name = "Reflected XSS",
        status = "open",
        severity = "high",
        exploitability = "hacker",
        owaspTop10 = "hacker",
        description = "hacker",
        risk = "",
        references="www.example.com",
        remidiation = ""

)
vulnerability02 = Vulnerability(
        report_id = "baf03af5f64e438a9bad9b161863782b",
        name = "Stroed XSS",
        status = "open",
        severity = "high",
        exploitability = "hacker",
        owaspTop10 = "hacker",
        description = "hacker",
        risk = "",
        references="www.example.com",
        remidiation = ""

)
vulnerability03 = Vulnerability(
        report_id = "baf03af5f64e438a9bad9b161863782b",
        name = "Injection",
        status = "open",
        severity = "high",
        exploitability = "hacker",
        owaspTop10 = "hacker",
        description = "hacker",
        references="www.example.com",
        risk = "",
        remidiation = ""

)
#add vuln
Vulnerability.addVulnerability(vulnerability01) #workring
Vulnerability.addVulnerability(vulnerability02)
Vulnerability.addVulnerability(vulnerability03)

#find all vuln of report
print("testing find all vuln of a project")
vulnerabilities_list = []
vulnerabilities = Vulnerability.getVulnerabilities("baf03af5f64e438a9bad9b161863782b") #working
project = Project.getProject("baf03af5f64e438a9bad9b161863782b")
print(project["client"])
for vuln in vulnerabilities:
    vulnerabilities_list.append(vuln)
for vuln in vulnerabilities_list:
    print(vuln["name"], vuln["severity"], vuln["_id"], vuln["status"])

#find one vuln
print("testing find one vuln")
vuln = Vulnerability.getVulnerability("7c40e40dfc7b4f97a3e3436838759403")
print(vuln)

#edit vuln
print("testing edit")
print(Vulnerability.editVulnerability(id="14ce263fde964e7ead2b424bc712dd79", newObj={"status":"closed"})) #working
vuln = Vulnerability.getVulnerability("14ce263fde964e7ead2b424bc712dd79") 
print(vuln)


#delete vuln
print("testing delete")
print(Vulnerability.deleteVulnerability(id="0d3dfa4940b2467ebcb368d8ab82a639")) #working

#delete vuln of one project
print("testing delete many vuln")
print(Vulnerability.deleteVulnerabilitiesOfProject(report_id='baf03af5f64e438a9bad9b161863782b')) #working